{% extends "base.html" %}

{% block title %}Call Records — Chapter {{ content.chapter_number }}{% endblock %}

{% block head_extra %}
<style>
  .cg-page {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.5rem;
    padding: 1.25rem 1rem 3rem;
  }

  .cg-heading {
    font-family: var(--font-display);
    font-size: clamp(1.1rem, 3.5vw, 1.65rem);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: #fff;
    text-shadow: 0 0 14px rgba(180, 0, 0, 0.5);
    text-align: center;
    margin: 0;
  }

  .cg-sub {
    font-size: 0.84rem;
    color: var(--text-muted);
    font-style: italic;
    text-align: center;
    margin: 0;
    max-width: 640px;
  }

  /* ── Two phone screens ── */
  .cg-phones {
    display: flex;
    gap: 1.25rem;
    width: 100%;
    max-width: 820px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .cg-phone {
    flex: 1 1 300px;
    max-width: 360px;
    background: #0a0a0a;
    border: 1px solid var(--border-blood);
    border-radius: 18px;
    overflow: hidden;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(180, 0, 0, 0.08);
  }

  /* Status bar */
  .cg-phone-bar {
    background: #111;
    padding: 0.4rem 1rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: 1px solid #1a1a1a;
  }

  .cg-phone-victim {
    font-family: var(--font-display);
    font-size: 0.7rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--accent-red);
  }

  .cg-phone-label {
    font-size: 0.65rem;
    color: #444;
    letter-spacing: 0.08em;
  }

  /* App header inside phone */
  .cg-app-hdr {
    background: #111;
    padding: 0.6rem 1rem 0.5rem;
    font-family: var(--font-display);
    font-size: 0.78rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #666;
    border-bottom: 1px solid #1a1a1a;
  }

  /* Call log list */
  .cg-call-list {
    list-style: none;
    margin: 0;
    padding: 0;
    max-height: 380px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: #2a0000 #0a0a0a;
  }

  .cg-call-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.65rem 1rem;
    border-bottom: 1px solid #111;
    transition: background 0.15s;
  }

  .cg-call-item:hover {
    background: rgba(180, 0, 0, 0.05);
  }

  .cg-call-icon {
    flex: 0 0 32px;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: #1a1a1a;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
  }

  .cg-call-icon.in {
    color: #4caf50;
  }

  .cg-call-icon.out {
    color: #5ba3f5;
  }

  .cg-call-icon.miss {
    color: #e53935;
  }

  .cg-call-info {
    flex: 1;
    min-width: 0;
  }

  .cg-call-name {
    font-size: 0.88rem;
    color: #ddd;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-weight: 500;
  }

  .cg-call-detail {
    font-size: 0.7rem;
    color: #555;
    margin-top: 0.1rem;
  }

  .cg-call-time {
    font-size: 0.68rem;
    color: #444;
    flex-shrink: 0;
  }

  /* ── Answer section ── */
  .cg-answer-wrap {
    width: 100%;
    max-width: 480px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.9rem;
  }

  .cg-answer-label {
    font-family: var(--font-display);
    font-size: 0.8rem;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    color: var(--accent-red);
    text-align: center;
  }

  .cg-answer-row {
    display: flex;
    width: 100%;
    gap: 0.5rem;
  }

  .cg-answer-input {
    flex: 1;
    background: rgba(0, 0, 0, 0.55);
    border: 1px solid rgba(180, 0, 0, 0.3);
    border-radius: 4px;
    padding: 0.65rem 0.9rem;
    color: #e0e0e0;
    font-size: 1rem;
    font-family: var(--font-body);
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    -webkit-appearance: none;
  }

  .cg-answer-input:focus {
    border-color: var(--accent-red);
    box-shadow: 0 0 10px rgba(180, 0, 0, 0.3);
  }

  .cg-answer-input.error {
    border-color: #e53935;
  }

  .cg-answer-input.correct {
    border-color: #2e7d32;
  }

  .cg-submit-btn {
    font-family: var(--font-display);
    font-size: 0.85rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: #fff;
    background: transparent;
    border: 1px solid var(--border-blood);
    border-radius: 4px;
    padding: 0.65rem 1.25rem;
    cursor: pointer;
    white-space: nowrap;
    transition: background 0.25s, box-shadow 0.25s;
  }

  .cg-submit-btn:hover {
    background: var(--accent-red);
    box-shadow: 0 0 14px var(--glow-red);
  }

  .cg-submit-btn:disabled {
    opacity: 0.35;
    cursor: default;
    pointer-events: none;
  }

  .cg-error-msg {
    display: none;
    font-size: 0.8rem;
    color: #e57373;
    font-style: italic;
    text-align: center;
  }

  /* ── Reveal ── */
  .cg-reveal {
    display: none;
    max-width: 480px;
    width: 100%;
    text-align: center;
    animation: cg-fade 0.9s ease forwards;
  }

  @keyframes cg-fade {
    from {
      opacity: 0;
      transform: translateY(14px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .cg-reveal-msg {
    font-family: var(--font-display);
    font-size: 0.8rem;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: #777;
    margin-bottom: 1.1rem;
  }

  .cg-proceed-btn {
    font-family: var(--font-display);
    font-size: 1rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: #fff;
    background: transparent;
    border: 1px solid var(--border-blood);
    border-radius: 4px;
    padding: 0.7rem 2.25rem;
    cursor: pointer;
    transition: background 0.25s, box-shadow 0.25s;
  }

  .cg-proceed-btn:hover {
    background: var(--accent-red);
    box-shadow: 0 0 18px var(--glow-red);
  }

  @media (max-width: 600px) {
    .cg-phones {
      gap: 0.75rem;
    }

    .cg-phone {
      max-width: 100%;
    }

    .cg-call-list {
      max-height: 260px;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="cg-page">

  <h1 class="cg-heading">Call Record Analysis</h1>
  <p class="cg-sub">
    Cross-reference the call histories of both victims. Identify the contact that appears in <em>both</em> records —
    they may be the link you're looking for.
  </p>

  <div class="cg-phones">

    <!-- VICTIM A -->
    <div class="cg-phone">
      <div class="cg-phone-bar">
        <span class="cg-phone-victim">Victim A</span>
        <span class="cg-phone-label">●●● ENCRYPTED</span>
      </div>
      <div class="cg-app-hdr">Recent Calls</div>
      <ul class="cg-call-list">
        <li class="cg-call-item">
          <div class="cg-call-icon out">↗</div>
          <div class="cg-call-info">
            <div class="cg-call-name">Sarah Mitchell</div>
            <div class="cg-call-detail">Outgoing · 3 min 12 s</div>
          </div>
          <div class="cg-call-time">Tue 9:41 AM</div>
        </li>
        <li class="cg-call-item">
          <div class="cg-call-icon miss">✕</div>
          <div class="cg-call-info">
            <div class="cg-call-name">James Okafor</div>
            <div class="cg-call-detail">Missed call</div>
          </div>
          <div class="cg-call-time">Tue 10:03 AM</div>
        </li>
        <li class="cg-call-item">
          <div class="cg-call-icon in">↙</div>
          <div class="cg-call-info">
            <div class="cg-call-name">William Bradley</div>
            <div class="cg-call-detail">Incoming · 11 min 07 s</div>
          </div>
          <div class="cg-call-time">Tue 11:28 AM</div>
        </li>
        <li class="cg-call-item">
          <div class="cg-call-icon out">↗</div>
          <div class="cg-call-info">
            <div class="cg-call-name">Marcus Chen</div>
            <div class="cg-call-detail">Outgoing · 1 min 44 s</div>
          </div>
          <div class="cg-call-time">Wed 8:15 AM</div>
        </li>
        <li class="cg-call-item">
          <div class="cg-call-icon in">↙</div>
          <div class="cg-call-info">
            <div class="cg-call-name">Diane Holloway</div>
            <div class="cg-call-detail">Incoming · 6 min 51 s</div>
          </div>
          <div class="cg-call-time">Wed 2:37 PM</div>
        </li>
        <li class="cg-call-item">
          <div class="cg-call-icon out">↗</div>
          <div class="cg-call-info">
            <div class="cg-call-name">Kevin Tran</div>
            <div class="cg-call-detail">Outgoing · 0 min 28 s</div>
          </div>
          <div class="cg-call-time">Thu 7:52 AM</div>
        </li>
        <li class="cg-call-item">
          <div class="cg-call-icon miss">✕</div>
          <div class="cg-call-info">
            <div class="cg-call-name">Linda Pacheco</div>
            <div class="cg-call-detail">Missed call</div>
          </div>
          <div class="cg-call-time">Thu 4:19 PM</div>
        </li>
      </ul>
    </div>

    <!-- VICTIM B -->
    <div class="cg-phone">
      <div class="cg-phone-bar">
        <span class="cg-phone-victim">Victim B</span>
        <span class="cg-phone-label">●●● ENCRYPTED</span>
      </div>
      <div class="cg-app-hdr">Recent Calls</div>
      <ul class="cg-call-list">
        <li class="cg-call-item">
          <div class="cg-call-icon in">↙</div>
          <div class="cg-call-info">
            <div class="cg-call-name">Angela Pierce</div>
            <div class="cg-call-detail">Incoming · 2 min 09 s</div>
          </div>
          <div class="cg-call-time">Mon 6:14 PM</div>
        </li>
        <li class="cg-call-item">
          <div class="cg-call-icon out">↗</div>
          <div class="cg-call-info">
            <div class="cg-call-name">Robert Faure</div>
            <div class="cg-call-detail">Outgoing · 8 min 33 s</div>
          </div>
          <div class="cg-call-time">Tue 8:47 AM</div>
        </li>
        <li class="cg-call-item">
          <div class="cg-call-icon miss">✕</div>
          <div class="cg-call-info">
            <div class="cg-call-name">Nina Castillo</div>
            <div class="cg-call-detail">Missed call</div>
          </div>
          <div class="cg-call-time">Tue 9:58 AM</div>
        </li>
        <li class="cg-call-item">
          <div class="cg-call-icon out">↗</div>
          <div class="cg-call-info">
            <div class="cg-call-name">William Bradley</div>
            <div class="cg-call-detail">Outgoing · 17 min 42 s</div>
          </div>
          <div class="cg-call-time">Tue 11:55 AM</div>
        </li>
        <li class="cg-call-item">
          <div class="cg-call-icon in">↙</div>
          <div class="cg-call-info">
            <div class="cg-call-name">Thomas Wren</div>
            <div class="cg-call-detail">Incoming · 4 min 18 s</div>
          </div>
          <div class="cg-call-time">Wed 1:02 PM</div>
        </li>
        <li class="cg-call-item">
          <div class="cg-call-icon out">↗</div>
          <div class="cg-call-info">
            <div class="cg-call-name">Derek Solano</div>
            <div class="cg-call-detail">Outgoing · 0 min 54 s</div>
          </div>
          <div class="cg-call-time">Wed 5:30 PM</div>
        </li>
        <li class="cg-call-item">
          <div class="cg-call-icon miss">✕</div>
          <div class="cg-call-info">
            <div class="cg-call-name">Heather Bloom</div>
            <div class="cg-call-detail">Missed call</div>
          </div>
          <div class="cg-call-time">Thu 9:11 AM</div>
        </li>
      </ul>
    </div>

  </div><!-- /.cg-phones -->

  <!-- ── Answer ── -->
  <div class="cg-answer-wrap">
    <p class="cg-answer-label">Common contact found in both records:</p>
    <div class="cg-answer-row">
      <input class="cg-answer-input" id="cg-input" type="text" autocomplete="off" autocorrect="off" spellcheck="false"
        placeholder="Enter full name…" />
      <button class="cg-submit-btn" id="cg-submit">Confirm</button>
    </div>
    <p class="cg-error-msg" id="cg-error">
      ✘ &nbsp; That contact does not appear in both records. Keep searching.
    </p>
  </div>

  <!-- ── Reveal ── -->
  <div class="cg-reveal" id="cg-reveal">
    <p class="cg-reveal-msg">✔ &nbsp; Common contact identified. Cross-reference logged.</p>
    <button class="cg-proceed-btn" id="btn-proceed">→ CLOSE THE FILE</button>
  </div>

</div>
{% endblock %}

{% block scripts %}
<script>
  (function () {
    "use strict";

    var CONTENT_ID = {{ content.id | int
  }};
  var ANSWER = "william bradley"; /* case-insensitive */

  var input = document.getElementById("cg-input");
  var submitBtn = document.getElementById("cg-submit");
  var errorEl = document.getElementById("cg-error");
  var revealEl = document.getElementById("cg-reveal");

  input.addEventListener("keydown", function (e) {
    if (e.key === "Enter") submitBtn.click();
  });

  submitBtn.addEventListener("click", function () {
    var val = input.value.trim().toLowerCase();
    if (val !== ANSWER) {
      input.classList.add("error");
      input.classList.remove("correct");
      errorEl.style.display = "block";
      return;
    }

    /* Correct */
    input.classList.remove("error");
    input.classList.add("correct");
    errorEl.style.display = "none";
    submitBtn.disabled = true;

    fetch("/submit/" + CONTENT_ID, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ completed: true })
    })
      .then(function (r) { return r.json(); })
      .catch(function () { return {}; })
      .finally(function () {
        revealEl.style.display = "block";
      });
  });

  document.getElementById("btn-proceed").addEventListener("click", function () {
    window.location.href = "/chapters";
  });
}) ();
</script>
{% endblock %}